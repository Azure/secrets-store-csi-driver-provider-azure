jobs:
- job: unit_test
  timeoutInMinutes: 10
  cancelTimeoutInMinutes: 5
  workspace:
    clean: all
  variables:
    - name: TRIVY_VERSION
      value: 0.19.2
  steps:
    - script: make lint
      displayName: Run lint
    - script: make build build-windows
      displayName: Build
    - script: make unit-test
      displayName: Run unit tests
    - script: bash <(curl -s https://codecov.io/bash) -C $(Build.SourceVersion)
      displayName: Upload coverage to codecov
    - script: make helm-lint
      displayName: Run helm lint
    - template: scan-images.yaml
