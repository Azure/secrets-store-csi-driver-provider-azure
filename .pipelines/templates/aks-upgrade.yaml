parameters:
  - name: upgradeVersion
    type: string

steps:
  - script: |
      echo "Upgrading to Kubernetes ${{ parameters.upgradeVersion }}"
      az aks upgrade -g ${AZURE_CLUSTER_NAME} -n ${AZURE_CLUSTER_NAME} -k ${{ parameters.upgradeVersion }} --yes

      # Sleep for 120 seconds to wait for nodes and pods to become ready
      sleep 2m
      kubectl wait --for=condition=ready node --all
      kubectl wait pod -n kube-system --for=condition=Ready --all
      kubectl get nodes -owide
      kubectl cluster-info
    displayName: "Upgrade kubernetes version"
    condition: and(succeeded(), eq(variables['CLUSTER_TYPE'], 'aks'))
