<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.75.1"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel=alternate type=application/rss+xml href=https://azure.github.io/secrets-store-csi-driver-provider-azure/getting-started/index.xml><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/secrets-store-csi-driver-provider-azure/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/secrets-store-csi-driver-provider-azure/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/secrets-store-csi-driver-provider-azure/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/secrets-store-csi-driver-provider-azure/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/secrets-store-csi-driver-provider-azure/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/secrets-store-csi-driver-provider-azure/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/secrets-store-csi-driver-provider-azure/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/secrets-store-csi-driver-provider-azure/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/secrets-store-csi-driver-provider-azure/favicons/android-192x192.png sizes=192x192><title>Getting Started | Azure Key Vault Provider for Secrets Store CSI Driver</title><meta property="og:title" content="Getting Started"><meta property="og:description" content="This guide will walk you through the steps to configure and run the Azure Key Vault provider for Secrets Store CSI driver on Kubernetes."><meta property="og:type" content="website"><meta property="og:url" content="https://azure.github.io/secrets-store-csi-driver-provider-azure/getting-started/"><meta property="og:site_name" content="Azure Key Vault Provider for Secrets Store CSI Driver"><meta itemprop=name content="Getting Started"><meta itemprop=description content="This guide will walk you through the steps to configure and run the Azure Key Vault provider for Secrets Store CSI driver on Kubernetes."><meta name=twitter:card content="summary"><meta name=twitter:title content="Getting Started"><meta name=twitter:description content="This guide will walk you through the steps to configure and run the Azure Key Vault provider for Secrets Store CSI driver on Kubernetes."><link rel=preload href=/secrets-store-csi-driver-provider-azure/scss/main.min.0f7031b006b8b404759311bd4ef1bf9638ec45b75eff42f5faaf032cde061fc2.css as=style><link href=/secrets-store-csi-driver-provider-azure/scss/main.min.0f7031b006b8b404759311bd4ef1bf9638ec45b75eff42f5faaf032cde061fc2.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script><script src=https://unpkg.com/lunr@2.3.8/lunr.min.js integrity=sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY crossorigin=anonymous></script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/secrets-store-csi-driver-provider-azure/><span class=navbar-logo></span><span class="text-uppercase font-weight-bold">Azure Key Vault Provider for Secrets Store CSI Driver</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/secrets-store-csi-driver-provider-azure/><span class=active>Documentation</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/secrets-store-csi-driver-provider-azure/offline-search-index.d1ed7bb49eb6d9ddab7f02324d907fd7.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><nav class="collapse td-sidebar-nav pt-2 pl-4" id=td-section-nav><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/secrets-store-csi-driver-provider-azure/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Documentation</a></li><ul><li class="collapse show" id=secrets-store-csi-driver-provider-azure><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/secrets-store-csi-driver-provider-azure/getting-started/ class="align-left pl-0 pr-2 active td-sidebar-link td-sidebar-link__section">Getting Started</a></li><ul><li class="collapse show" id=secrets-store-csi-driver-provider-azuregetting-started></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/secrets-store-csi-driver-provider-azure/demos-and-tutorials/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Demos and Tutorials</a></li><ul><li class="collapse show" id=secrets-store-csi-driver-provider-azuredemos-and-tutorials><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/secrets-store-csi-driver-provider-azure/demos-and-tutorials/tutorials/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Tutorials</a></li><ul><li class="collapse show" id=secrets-store-csi-driver-provider-azuredemos-and-tutorialstutorials><a class="td-sidebar-link td-sidebar-link__page" id=m-secrets-store-csi-driver-provider-azuredemos-and-tutorialstutorialssetup-keyvault href=/secrets-store-csi-driver-provider-azure/demos-and-tutorials/tutorials/setup-keyvault/>Set up an Azure KeyVault</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/secrets-store-csi-driver-provider-azure/demos-and-tutorials/community-demos-and-presentations/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Community Demos and Presentations</a></li><ul><li class="collapse show" id=secrets-store-csi-driver-provider-azuredemos-and-tutorialscommunity-demos-and-presentations><a class="td-sidebar-link td-sidebar-link__page" id=m-secrets-store-csi-driver-provider-azuredemos-and-tutorialscommunity-demos-and-presentationshoussem-dellai href=/secrets-store-csi-driver-provider-azure/demos-and-tutorials/community-demos-and-presentations/houssem-dellai/>Houssem Dellai - Retrieving database login info from Azure KeyVault</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-secrets-store-csi-driver-provider-azuredemos-and-tutorialscommunity-demos-and-presentationsnilesh-gule href=/secrets-store-csi-driver-provider-azure/demos-and-tutorials/community-demos-and-presentations/nilesh-gule/>Nilesh Gule - Retrieving RabbitMQ related secret from Azure KeyVault</a></li></ul></ul></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/secrets-store-csi-driver-provider-azure/configurations/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Configurations</a></li><ul><li class="collapse show" id=secrets-store-csi-driver-provider-azureconfigurations><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/secrets-store-csi-driver-provider-azure/configurations/identity-access-modes/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Identity Access Modes</a></li><ul><li class="collapse show" id=secrets-store-csi-driver-provider-azureconfigurationsidentity-access-modes><a class="td-sidebar-link td-sidebar-link__page" id=m-secrets-store-csi-driver-provider-azureconfigurationsidentity-access-modesservice-principal-mode href=/secrets-store-csi-driver-provider-azure/configurations/identity-access-modes/service-principal-mode/>Service Principal</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-secrets-store-csi-driver-provider-azureconfigurationsidentity-access-modespod-identity-mode href=/secrets-store-csi-driver-provider-azure/configurations/identity-access-modes/pod-identity-mode/>Pod Identity</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-secrets-store-csi-driver-provider-azureconfigurationsidentity-access-modesuser-assigned-msi-mode href=/secrets-store-csi-driver-provider-azure/configurations/identity-access-modes/user-assigned-msi-mode/>VMSS User Assigned Managed Identity</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-secrets-store-csi-driver-provider-azureconfigurationsidentity-access-modessystem-assigned-msi-mode href=/secrets-store-csi-driver-provider-azure/configurations/identity-access-modes/system-assigned-msi-mode/>VMSS System Assigned Managed Identity</a></li></ul></ul><a class="td-sidebar-link td-sidebar-link__page" id=m-secrets-store-csi-driver-provider-azureconfigurationssync-with-k8-secretes href=/secrets-store-csi-driver-provider-azure/configurations/sync-with-k8-secretes/>Syncronize Mounted Content with Kubernetes Secret</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-secrets-store-csi-driver-provider-azureconfigurationsenable-auto-rotation-secrets href=/secrets-store-csi-driver-provider-azure/configurations/enable-auto-rotation-secrets/>Enable Auto Rotation of Secrets</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-secrets-store-csi-driver-provider-azureconfigurationsset-env-var href=/secrets-store-csi-driver-provider-azure/configurations/set-env-var/>Set your Environment Variable to Reference a Kubernetes Secret</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-secrets-store-csi-driver-provider-azureconfigurationscustom-environments href=/secrets-store-csi-driver-provider-azure/configurations/custom-environments/>Custom Azure Environments</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-secrets-store-csi-driver-provider-azureconfigurationsgetting-certs-and-keys href=/secrets-store-csi-driver-provider-azure/configurations/getting-certs-and-keys/>Getting Certificates and Keys using Azure Key Vault Provider</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/secrets-store-csi-driver-provider-azure/troubleshooting/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Troubleshooting</a></li><ul><li class="collapse show" id=secrets-store-csi-driver-provider-azuretroubleshooting><a class="td-sidebar-link td-sidebar-link__page" id=m-secrets-store-csi-driver-provider-azuretroubleshootingless-than-version-009 href=/secrets-store-csi-driver-provider-azure/troubleshooting/less-than-version-0.0.9/>For Azure Key Vault Provider version &lt; 0.0.9</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-secrets-store-csi-driver-provider-azuretroubleshootingequal-to-and-greater-than-version-009 href=/secrets-store-csi-driver-provider-azure/troubleshooting/equal-to-and-greater-than-version-0.0.9/>For Azure Key Vault Provider version 0.0.9+</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/secrets-store-csi-driver-provider-azure/upgrading/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Upgrading</a></li><ul><li class="collapse show" id=secrets-store-csi-driver-provider-azureupgrading></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/secrets-store-csi-driver-provider-azure/support/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Support</a></li><ul><li class="collapse show" id=secrets-store-csi-driver-provider-azuresupport></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/secrets-store-csi-driver-provider-azure/testing/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Testing</a></li><ul><li class="collapse show" id=secrets-store-csi-driver-provider-azuretesting></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/secrets-store-csi-driver-provider-azure/contribution-guidelines/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Contribution Guidelines</a></li><ul><li class="collapse show" id=secrets-store-csi-driver-provider-azurecontribution-guidelines></li></ul></ul></li></ul></ul></nav></div></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/Azure/secrets-store-csi-driver-provider-azure/edit/master/content/en/getting-started/_index.md target=_blank><i class="fa fa-edit fa-fw"></i>Edit this page</a>
<a href="https://github.com/Azure/secrets-store-csi-driver-provider-azure/new/master/content/en/getting-started/_index.md?filename=change-me.md&value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" target=_blank><i class="fa fa-edit fa-fw"></i>Create child page</a>
<a href="https://github.com/Azure/secrets-store-csi-driver-provider-azure/issues/new?title=Getting%20Started" target=_blank><i class="fab fa-github fa-fw"></i>Create documentation issue</a>
<a href="https://github.com/Azure/secrets-store-csi-driver-provider-azure/issues/new?assignees=&labels=bug&template=bug-report.md&title=/issues/new" target=_blank><i class="fas fa-tasks fa-fw"></i>Create project issue</a></div><nav id=TableOfContents><ul><li><ul><li><a href=#install-the-secrets-store-csi-driver-and-the-azure-keyvault-provider>Install the Secrets Store CSI Driver and the Azure Keyvault Provider</a></li><li><a href=#using-the-azure-key-vault-provider>Using the Azure Key Vault Provider</a></li></ul></li></ul></nav></div><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><nav aria-label=breadcrumb class="d-none d-md-block d-print-none"><ol class="breadcrumb spb-1"><li class="breadcrumb-item active" aria-current=page><a href=https://azure.github.io/secrets-store-csi-driver-provider-azure/getting-started/>Getting Started</a></li></ol></nav><div class=td-content><h1>Getting Started</h1><div class=lead>This guide will walk you through the steps to configure and run the Azure Key Vault provider for Secrets Store CSI driver on Kubernetes.</div><h3 id=install-the-secrets-store-csi-driver-and-the-azure-keyvault-provider>Install the Secrets Store CSI Driver and the Azure Keyvault Provider</h3><p><strong>Prerequisites</strong></p><p>Recommended Kubernetes version:</p><ul><li>For Linux - v1.16.0+</li><li>For Windows - v1.18.0+</li></ul><blockquote><p>For Kubernetes version 1.15 and below, please use <a href=https://github.com/Azure/kubernetes-keyvault-flexvol>Azure Keyvault Flexvolume</a></p></blockquote><p><strong>Deployment using Helm</strong></p><p>Follow <a href=https://github.com/Azure/secrets-store-csi-driver-provider-azure/blob/master/charts/csi-secrets-store-provider-azure/README.md>this guide</a> to install the Secrets Store CSI driver and the Azure Key Vault provider using Helm.</p><p>Alternatively, follow <a href=https://github.com/Azure/secrets-store-csi-driver-provider-azure/blob/master/docs/install-yamls.md>this guide</a> to install using deployment yamls.</p><p><strong>In addition, if you are using Secrets Store CSI Driver and the Azure Keyvault Provider in a cluster with <a href=https://kubernetes.io/docs/concepts/policy/pod-security-policy/>pod security policy</a> enabled</strong>, review and create the following policy that enables the spec required for Secrets Store CSI Driver and the Azure Keyvault Provider to work:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl apply -f https://raw.githubusercontent.com/Azure/secrets-store-csi-driver-provider-azure/master/deployment/pod-security-policy.yaml
</code></pre></div><h3 id=using-the-azure-key-vault-provider>Using the Azure Key Vault Provider</h3><h4 id=create-a-new-azure-key-vault-resource-or-use-an-existing-one>Create a new Azure Key Vault resource or use an existing one</h4><p>In addition to a Kubernetes cluster, you will need an Azure Key Vault resource with secret content to access. Follow <a href=https://docs.microsoft.com/azure/key-vault/secrets/quick-create-portal>this quickstart tutorial</a> to deploy an Azure Key Vault and add an example secret to it.</p><p>Review the settings you desire for your Key Vault, such as what resources (Azure VMs, Azure Resource Manager, etc.) and what kind of network endpoints can access secrets in it.</p><p>Take note of the following properties for use in the next section:</p><ol><li>Name of secret object in Key Vault</li><li>Secret content type (secret, key, cert)</li><li>Name of Key Vault resource</li><li>Resource group the Key Vault resides within</li><li>Azure Subscription ID the Key Vault was provisioned with</li><li>Azure Tenant ID the Subscription ID belongs to</li></ol><h4 id=create-your-own-secretproviderclass-object>Create your own SecretProviderClass Object</h4><p>Create a <code>SecretProviderClass</code> custom resource to provide provider-specific parameters for the Secrets Store CSI driver. In this example, use an existing Azure Key Vault or the Azure Key Vault resource created previously.</p><blockquote><p>NOTE: The <code>SecretProviderClass</code> has to be in the same namespace as the pod referencing it.</p></blockquote><p>Update <a href=https://github.com/Azure/secrets-store-csi-driver-provider-azure/blob/master/examples/v1alpha1_secretproviderclass_service_principal.yaml>this sample deployment</a> to create a <code>SecretProviderClass</code> resource to provide Azure-specific parameters for the Secrets Store CSI driver.</p><p>To provide identity to access key vault, refer to the following <a href=#provide-identity-to-access-key-vault>section</a>.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>secrets-store.csi.x-k8s.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>SecretProviderClass</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>azure-kvname</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>provider</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>azure                   </span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>parameters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>usePodIdentity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;false&#34;</span><span style=color:#f8f8f8;text-decoration:underline>         </span><span style=color:#8f5902;font-style:italic># [OPTIONAL for Azure] if not provided, will default to &#34;false&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>useVMManagedIdentity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;false&#34;</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#8f5902;font-style:italic># [OPTIONAL available for version &gt; 0.0.4] if not provided, will default to &#34;false&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>userAssignedIdentityID</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;client_id&#34;</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># [OPTIONAL available for version &gt; 0.0.4] use the client id to specify which user assigned managed identity to use. If using a user assigned identity as the VM&#39;s managed identity, then specify the identity&#39;s client id. If empty, then defaults to use the system assigned identity on the VM</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>keyvaultName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;kvname&#34;</span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#8f5902;font-style:italic># the name of the KeyVault</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>cloudName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#8f5902;font-style:italic># [OPTIONAL available for version &gt; 0.0.4] if not provided, azure environment will default to AzurePublicCloud</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>cloudEnvFileName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#8f5902;font-style:italic># [OPTIONAL available for version &gt; 0.0.7] use to define path to file for populating azure environment</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>objects</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic>|
</span><span style=color:#8f5902;font-style:italic>      array:
</span><span style=color:#8f5902;font-style:italic>        - |
</span><span style=color:#8f5902;font-style:italic>          objectName: secret1
</span><span style=color:#8f5902;font-style:italic>          objectAlias: SECRET_1     # [OPTIONAL available for version &gt; 0.0.4] object alias
</span><span style=color:#8f5902;font-style:italic>          objectType: secret        # object types: secret, key or cert. For Key Vault certificates, refer to https://github.com/Azure/secrets-store-csi-driver-provider-azure/blob/master/docs/getting-certs-and-keys.md for the object type to use
</span><span style=color:#8f5902;font-style:italic>          objectVersion: &#34;&#34;         # [OPTIONAL] object versions, default to latest if empty
</span><span style=color:#8f5902;font-style:italic>        - |
</span><span style=color:#8f5902;font-style:italic>          objectName: key1
</span><span style=color:#8f5902;font-style:italic>          objectAlias: &#34;&#34;           # If provided then it has to be referenced in [secretObjects].[objectName] to sync with Kubernetes secrets 
</span><span style=color:#8f5902;font-style:italic>          objectType: key
</span><span style=color:#8f5902;font-style:italic>          objectVersion: &#34;&#34;
</span><span style=color:#8f5902;font-style:italic>    resourceGroup: &#34;rg1&#34;            # [REQUIRED for version &lt; 0.0.4] the resource group of the KeyVault
</span><span style=color:#8f5902;font-style:italic>    subscriptionId: &#34;subid&#34;         # [REQUIRED for version &lt; 0.0.4] the subscription ID of the KeyVault
</span><span style=color:#8f5902;font-style:italic>    tenantId: &#34;tid&#34;                 # the tenant ID of the KeyVault
</span><span style=color:#8f5902;font-style:italic>
</span></code></pre></div><table><thead><tr><th>Name</th><th>Required</th><th>Description</th><th>Default Value</th></tr></thead><tbody><tr><td>provider</td><td>yes</td><td>specify name of the provider</td><td>""</td></tr><tr><td>usePodIdentity</td><td>no</td><td>specify access mode: service principal or pod identity</td><td>&ldquo;false&rdquo;</td></tr><tr><td>useVMManagedIdentity</td><td>no</td><td>[<strong><em>available for version > 0.0.4</em></strong>] specify access mode to enable use of VM&rsquo;s managed identity</td><td>&ldquo;false&rdquo;</td></tr><tr><td>userAssignedIdentityID</td><td>no</td><td>[<strong><em>available for version > 0.0.4</em></strong>] the user assigned identity ID is required for VMSS User Assigned Managed Identity mode</td><td>""</td></tr><tr><td>keyvaultName</td><td>yes</td><td>name of a Key Vault instance</td><td>""</td></tr><tr><td>cloudName</td><td>no</td><td>[<strong><em>available for version > 0.0.4</em></strong>] name of the azure cloud based on azure go sdk (AzurePublicCloud, AzureUSGovernmentCloud, AzureChinaCloud, AzureGermanCloud, AzureStackCloud)</td><td>""</td></tr><tr><td>cloudEnvFileName</td><td>no</td><td>[<strong><em>available for version > 0.0.7</em></strong>] path to the file to be used while populating the Azure Environment (required if target cloud is AzureStackCloud). More details <a href=#other-azure-clouds>here</a>.</td><td>""</td></tr><tr><td>objects</td><td>yes</td><td>a string of arrays of strings</td><td>""</td></tr><tr><td>objectName</td><td>yes</td><td>name of a Key Vault object</td><td>""</td></tr><tr><td>objectAlias</td><td>no</td><td>[<strong><em>available for version > 0.0.4</em></strong>] specify the filename of the object when written to disk - defaults to objectName if not provided</td><td>""</td></tr><tr><td>objectType</td><td>yes</td><td>type of a Key Vault object: secret, key or cert.<br>For Key Vault certificates, refer to <a href=docs/getting-certs-and-keys.md>doc</a> for the object type to use.</br></td><td>""</td></tr><tr><td>objectVersion</td><td>no</td><td>version of a Key Vault object, if not provided, will use latest</td><td>""</td></tr><tr><td>objectFormat</td><td>no</td><td>[<strong><em>available for version > 0.0.7</em></strong>] the format of the Azure Key Vault object, supported types are pem and pfx. <code>objectFormat: pfx</code> is only supported with <code>objectType: secret</code> and PKCS12 or ECC certificates</td><td>&ldquo;pem&rdquo;</td></tr><tr><td>objectEncoding</td><td>no</td><td>[<strong><em>available for version > 0.0.8</em></strong>] the encoding of the Azure Key Vault secret object, supported types are <code>utf-8</code>, <code>hex</code> and <code>base64</code>. This option is supported only with <code>objectType: secret</code></td><td>&ldquo;utf-8&rdquo;</td></tr><tr><td>resourceGroup</td><td>no</td><td>[<strong><em>required for version &lt; 0.0.4</em></strong>] name of resource group containing key vault instance</td><td>""</td></tr><tr><td>subscriptionId</td><td>no</td><td>[<strong><em>required for version &lt; 0.0.4</em></strong>] subscription ID containing key vault instance</td><td>""</td></tr><tr><td>tenantId</td><td>yes</td><td>tenant ID containing key vault instance</td><td>""</td></tr></tbody></table><h4 id=provide-identity-to-access-key-vault>Provide Identity to Access Key Vault</h4><p>The Azure Key Vault Provider offers four modes for accessing a Key Vault instance:</p><ol><li><a href=../configurations/identity-access-modes/service-principal-mode>Service Principal</a></li><li><a href=../configurations/identity-access-modes/pod-identity-mode>Pod Identity</a></li><li><a href=../configurations/identity-access-modes/user-assigned-msi-mode>VMSS User Assigned Managed Identity</a></li><li><a href=../configurations/identity-access-modes/system-assigned-msi-mode>VMSS System Assigned Managed Identity</a></li></ol><h4 id=update-your-deployment-yaml>Update your Deployment Yaml</h4><p>To ensure your application is using the Secrets Store CSI driver, update your deployment yaml to use the <code>secrets-store.csi.k8s.io</code> driver and reference the <code>SecretProviderClass</code> resource created in the previous step.</p><p>Update your <a href=https://raw.githubusercontent.com/Azure/secrets-store-csi-driver-provider-azure/master/examples/nginx-pod-inline-volume-service-principal.yaml>linux deployment yaml</a> or <a href=https://raw.githubusercontent.com/Azure/secrets-store-csi-driver-provider-azure/master/examples/windows-pod-secrets-store-inline-volume-secret-providerclass.yaml>windows deployment yaml</a> to use the Secrets Store CSI driver and reference the <code>SecretProviderClass</code> resource created in the previous step.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>volumes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>secrets-store-inline</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>csi</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>driver</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>secrets-store.csi.k8s.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>readOnly</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>volumeAttributes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>secretProviderClass</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;azure-kvname&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></code></pre></div><h4 id=deploy-your-kubernetes-resources>Deploy your Kubernetes Resources</h4><ol><li><p>Deploy the SecretProviderClass yaml created previously. For example:</p><p><code>kubectl apply -f ./examples/v1alpha1_secretproviderclass.yaml</code></p></li><li><p>Deploy the application yaml created previously. For example:</p><p><code>kubectl apply -f ./examples/nginx-pod-inline-volume-service-principal.yaml</code></p></li></ol><h4 id=validate-the-secret>Validate the secret</h4><p>To validate, once the pod is started, you should see the new mounted content at the volume path specified in your deployment yaml.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#8f5902;font-style:italic>## show secrets held in secrets-store</span>
kubectl <span style=color:#204a87>exec</span> -it nginx-secrets-store-inline ls /mnt/secrets-store/

<span style=color:#8f5902;font-style:italic>## print a test secret held in secrets-store</span>
kubectl <span style=color:#204a87>exec</span> -it nginx-secrets-store-inline cat /mnt/secrets-store/secret1

</code></pre></div><div class=section-index><hr class=panel-line></div><div class="text-muted mt-5 pt-3 border-top">Last modified 01.01.0001</div></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Slack aria-label=Slack><a class=text-white target=_blank rel="noopener noreferrer" href=https://kubernetes.slack.com/archives/C013PUP2WRK><i class="fab fa-slack"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel="noopener noreferrer" href=https://github.com/Azure/secrets-store-csi-driver-provider-azure><i class="fab fa-github"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2021 Azure Compute OSS Upstream Team All Rights Reserved</small></div></div></div></footer></div><script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script><script src=/secrets-store-csi-driver-provider-azure/js/main.min.460c8ae21829f9b330823a08f34ac961d7d0daa8874c8c9eba7ea0484bb42a79.js integrity="sha256-RgyK4hgp+bMwgjoI80rJYdfQ2qiHTIyeun6gSEu0Knk=" crossorigin=anonymous></script></body></html>