<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.75.1"><link rel=alternate type=application/rss+xml href=https://azure.github.io/secrets-store-csi-driver-provider-azure/docs/getting-started/usage/index.xml><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel="shortcut icon" href=/secrets-store-csi-driver-provider-azure/docs/favicons/favicon.ico><link rel=apple-touch-icon href=/secrets-store-csi-driver-provider-azure/docs/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/secrets-store-csi-driver-provider-azure/docs/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/secrets-store-csi-driver-provider-azure/docs/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/secrets-store-csi-driver-provider-azure/docs/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/secrets-store-csi-driver-provider-azure/docs/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/secrets-store-csi-driver-provider-azure/docs/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/secrets-store-csi-driver-provider-azure/docs/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/secrets-store-csi-driver-provider-azure/docs/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/secrets-store-csi-driver-provider-azure/docs/favicons/android-192x192.png sizes=192x192><title>Using the Azure Key Vault Provider | Azure Key Vault Provider for Secrets Store CSI Driver</title><meta property="og:title" content="Using the Azure Key Vault Provider"><meta property="og:description" content="This guide will walk you through the steps to configure and run the Azure Key Vault provider for Secrets Store CSI driver on Kubernetes."><meta property="og:type" content="website"><meta property="og:url" content="https://azure.github.io/secrets-store-csi-driver-provider-azure/docs/getting-started/usage/"><meta property="og:site_name" content="Azure Key Vault Provider for Secrets Store CSI Driver"><meta itemprop=name content="Using the Azure Key Vault Provider"><meta itemprop=description content="This guide will walk you through the steps to configure and run the Azure Key Vault provider for Secrets Store CSI driver on Kubernetes."><meta name=twitter:card content="summary"><meta name=twitter:title content="Using the Azure Key Vault Provider"><meta name=twitter:description content="This guide will walk you through the steps to configure and run the Azure Key Vault provider for Secrets Store CSI driver on Kubernetes."><link rel=preload href=/secrets-store-csi-driver-provider-azure/docs/scss/main.min.4ca46c7779e12beaabf98a54574d3cfc6e8be930d2014b43de9cc43dac12f2e0.css as=style><link href=/secrets-store-csi-driver-provider-azure/docs/scss/main.min.4ca46c7779e12beaabf98a54574d3cfc6e8be930d2014b43de9cc43dac12f2e0.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script><script src=https://unpkg.com/lunr@2.3.8/lunr.min.js integrity=sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY crossorigin=anonymous></script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/secrets-store-csi-driver-provider-azure/docs/><span class=navbar-logo></span><span class="text-uppercase font-weight-bold">Azure Key Vault Provider for Secrets Store CSI Driver</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/secrets-store-csi-driver-provider-azure/docs/><span class=active>Documentation</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/secrets-store-csi-driver-provider-azure/docs/offline-search-index.b5f7bbcf3481f0d3f934d602b58cdc63.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><div id=content-mobile><form class="td-sidebar__search d-flex align-items-center"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/secrets-store-csi-driver-provider-azure/docs/offline-search-index.b5f7bbcf3481f0d3f934d602b58cdc63.json data-offline-search-base-href=/ data-offline-search-max-results=10>
<button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form></div><div id=content-desktop></div><nav class="collapse td-sidebar-nav" id=td-section-nav><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/secrets-store-csi-driver-provider-azure/docs/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Documentation</a></li><ul><li class="collapse show" id=secrets-store-csi-driver-provider-azuredocs><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/secrets-store-csi-driver-provider-azure/docs/getting-started/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Getting Started</a></li><ul><li class="collapse show" id=secrets-store-csi-driver-provider-azuredocsgetting-started><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/secrets-store-csi-driver-provider-azure/docs/getting-started/installation/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Installation</a></li><ul><li class=collapse id=secrets-store-csi-driver-provider-azuredocsgetting-startedinstallation></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/secrets-store-csi-driver-provider-azure/docs/getting-started/usage/ class="align-left pl-0 pr-2 active td-sidebar-link td-sidebar-link__section">Using the Azure Key Vault Provider</a></li><ul><li class="collapse show" id=secrets-store-csi-driver-provider-azuredocsgetting-startedusage></li></ul></ul></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/secrets-store-csi-driver-provider-azure/docs/demos/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Demos</a></li><ul><li class=collapse id=secrets-store-csi-driver-provider-azuredocsdemos><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/secrets-store-csi-driver-provider-azure/docs/demos/standard-walkthrough/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Standard Walkthrough</a></li><ul><li class=collapse id=secrets-store-csi-driver-provider-azuredocsdemosstandard-walkthrough></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/secrets-store-csi-driver-provider-azure/docs/demos/community-demos-and-presentations/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Community Demos and Presentations</a></li><ul><li class=collapse id=secrets-store-csi-driver-provider-azuredocsdemoscommunity-demos-and-presentations><a class="td-sidebar-link td-sidebar-link__page" id=m-secrets-store-csi-driver-provider-azuredocsdemoscommunity-demos-and-presentationshoussem-dellai href=/secrets-store-csi-driver-provider-azure/docs/demos/community-demos-and-presentations/houssem-dellai/>Houssem Dellai - Retrieving database login info from Azure KeyVault</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-secrets-store-csi-driver-provider-azuredocsdemoscommunity-demos-and-presentationshoussem-dellai-workload-identity href=/secrets-store-csi-driver-provider-azure/docs/demos/community-demos-and-presentations/houssem-dellai-workload-identity/>Houssem Dellai - Retrieving database login info from Azure KeyVault using Workload Identity</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-secrets-store-csi-driver-provider-azuredocsdemoscommunity-demos-and-presentationsnilesh-gule href=/secrets-store-csi-driver-provider-azure/docs/demos/community-demos-and-presentations/nilesh-gule/>Nilesh Gule - Retrieving RabbitMQ related secret from Azure KeyVault</a></li></ul></ul></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/secrets-store-csi-driver-provider-azure/docs/configurations/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Configurations</a></li><ul><li class=collapse id=secrets-store-csi-driver-provider-azuredocsconfigurations><a class="td-sidebar-link td-sidebar-link__page" id=m-secrets-store-csi-driver-provider-azuredocsconfigurationsfeature-flags href=/secrets-store-csi-driver-provider-azure/docs/configurations/feature-flags/>Feature Flags</a><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/secrets-store-csi-driver-provider-azure/docs/configurations/identity-access-modes/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Identity Access Modes</a></li><ul><li class=collapse id=secrets-store-csi-driver-provider-azuredocsconfigurationsidentity-access-modes><a class="td-sidebar-link td-sidebar-link__page" id=m-secrets-store-csi-driver-provider-azuredocsconfigurationsidentity-access-modesworkload-identity-mode href=/secrets-store-csi-driver-provider-azure/docs/configurations/identity-access-modes/workload-identity-mode/>Workload Identity</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-secrets-store-csi-driver-provider-azuredocsconfigurationsidentity-access-modessystem-assigned-msi-mode href=/secrets-store-csi-driver-provider-azure/docs/configurations/identity-access-modes/system-assigned-msi-mode/>System-assigned Managed Identity</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-secrets-store-csi-driver-provider-azuredocsconfigurationsidentity-access-modesuser-assigned-msi-mode href=/secrets-store-csi-driver-provider-azure/docs/configurations/identity-access-modes/user-assigned-msi-mode/>User-assigned Managed Identity</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-secrets-store-csi-driver-provider-azuredocsconfigurationsidentity-access-modesservice-principal-mode href=/secrets-store-csi-driver-provider-azure/docs/configurations/identity-access-modes/service-principal-mode/>Service Principal</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-secrets-store-csi-driver-provider-azuredocsconfigurationsidentity-access-modespod-identity-mode href=/secrets-store-csi-driver-provider-azure/docs/configurations/identity-access-modes/pod-identity-mode/>Pod Identity</a></li></ul></ul><a class="td-sidebar-link td-sidebar-link__page" id=m-secrets-store-csi-driver-provider-azuredocsconfigurationsmetrics href=/secrets-store-csi-driver-provider-azure/docs/configurations/metrics/>Metrics</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-secrets-store-csi-driver-provider-azuredocsconfigurationssync-with-k8s-secrets href=/secrets-store-csi-driver-provider-azure/docs/configurations/sync-with-k8s-secrets/>Sync Mounted Content with Kubernetes Secret</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-secrets-store-csi-driver-provider-azuredocsconfigurationssync-multiple-versions href=/secrets-store-csi-driver-provider-azure/docs/configurations/sync-multiple-versions/>Sync Multiple Versions of a Secret</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-secrets-store-csi-driver-provider-azuredocsconfigurationsenable-auto-rotation-secrets href=/secrets-store-csi-driver-provider-azure/docs/configurations/enable-auto-rotation-secrets/>Enable Auto Rotation of Secrets</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-secrets-store-csi-driver-provider-azuredocsconfigurationsset-env-var href=/secrets-store-csi-driver-provider-azure/docs/configurations/set-env-var/>Set your Environment Variable to Reference a Kubernetes Secret</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-secrets-store-csi-driver-provider-azuredocsconfigurationsingress-tls href=/secrets-store-csi-driver-provider-azure/docs/configurations/ingress-tls/>Enable NGINX Ingress Controller with TLS</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-secrets-store-csi-driver-provider-azuredocsconfigurationscustom-environments href=/secrets-store-csi-driver-provider-azure/docs/configurations/custom-environments/>Custom Azure Environments</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-secrets-store-csi-driver-provider-azuredocsconfigurationsgetting-certs-and-keys href=/secrets-store-csi-driver-provider-azure/docs/configurations/getting-certs-and-keys/>Getting Certificates and Keys using Azure Key Vault Provider</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-secrets-store-csi-driver-provider-azuredocsconfigurationsdeploy-in-openshift href=/secrets-store-csi-driver-provider-azure/docs/configurations/deploy-in-openshift/>Setup Secrets Store CSI Driver on Azure RedHat OpenShift (ARO)</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/secrets-store-csi-driver-provider-azure/docs/troubleshooting/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Troubleshooting</a></li><ul><li class=collapse id=secrets-store-csi-driver-provider-azuredocstroubleshooting></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/secrets-store-csi-driver-provider-azure/docs/upgrading/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Upgrading</a></li><ul><li class=collapse id=secrets-store-csi-driver-provider-azuredocsupgrading></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/secrets-store-csi-driver-provider-azure/docs/support/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Support</a></li><ul><li class=collapse id=secrets-store-csi-driver-provider-azuredocssupport></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/secrets-store-csi-driver-provider-azure/docs/contribution-guidelines/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Contribution Guidelines</a></li><ul><li class=collapse id=secrets-store-csi-driver-provider-azuredocscontribution-guidelines></li></ul></ul></li></ul></ul></nav></div></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/Azure/secrets-store-csi-driver-provider-azure/edit/master/content/en/getting-started/usage/_index.md target=_blank><i class="fa fa-edit fa-fw"></i>Edit this page</a>
<a href="https://github.com/Azure/secrets-store-csi-driver-provider-azure/new/master/content/en/getting-started/usage/_index.md?filename=change-me.md&value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" target=_blank><i class="fa fa-edit fa-fw"></i>Create child page</a>
<a href="https://github.com/Azure/secrets-store-csi-driver-provider-azure/issues/new?title=Using%20the%20Azure%20Key%20Vault%20Provider" target=_blank><i class="fab fa-github fa-fw"></i>Create documentation issue</a>
<a href="https://github.com/Azure/secrets-store-csi-driver-provider-azure/issues/new?assignees=&labels=bug&template=bug-report.md&title=/issues/new" target=_blank><i class="fas fa-tasks fa-fw"></i>Create project issue</a></div></div><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><nav aria-label=breadcrumb class="d-none d-md-block d-print-none"><ol class="breadcrumb spb-1"><li class=breadcrumb-item><a href=https://azure.github.io/secrets-store-csi-driver-provider-azure/docs/getting-started/>Getting Started</a></li><li class="breadcrumb-item active" aria-current=page><a href=https://azure.github.io/secrets-store-csi-driver-provider-azure/docs/getting-started/usage/>Using the Azure Key Vault Provider</a></li></ol></nav><div class=td-content><h1>Using the Azure Key Vault Provider</h1><div class=lead>This guide will walk you through the steps to configure and run the Azure Key Vault provider for Secrets Store CSI driver on Kubernetes.</div><h4 id=create-a-new-azure-key-vault-resource-or-use-an-existing-one>Create a new Azure Key Vault resource or use an existing one</h4><p>In addition to a Kubernetes cluster, you will need an Azure Key Vault resource with secret content to access. Follow <a href=https://docs.microsoft.com/azure/key-vault/secrets/quick-create-portal>this quickstart tutorial</a> to deploy an Azure Key Vault and add an example secret to it.</p><p>Review the settings you desire for your Key Vault, such as what resources (Azure VMs, Azure Resource Manager, etc.) and what kind of network endpoints can access secrets in it.</p><p>Take note of the following properties for use in the next section:</p><ol><li>Name of secret object in Key Vault</li><li>Secret content type (secret, key, cert)</li><li>Name of Key Vault resource</li><li>Azure Tenant ID the Subscription belongs to</li></ol><h4 id=create-your-own-secretproviderclass-object>Create your own SecretProviderClass Object</h4><p>Create a <code>SecretProviderClass</code> custom resource to provide provider-specific parameters for the Secrets Store CSI driver. In this example, use an existing Azure Key Vault or the Azure Key Vault resource created previously.</p><blockquote><p>NOTE: The <code>SecretProviderClass</code> has to be in the same namespace as the pod referencing it.</p></blockquote><p>Update <a href=https://raw.githubusercontent.com/Azure/secrets-store-csi-driver-provider-azure/master/examples/service-principal/v1alpha1_secretproviderclass_service_principal.yaml>this sample deployment</a> to create a <code>SecretProviderClass</code> resource to provide Azure-specific parameters for the Secrets Store CSI driver.</p><p>To provide identity to access Key Vault, refer to the following <a href=#provide-identity-to-access-key-vault>section</a>.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>secrets-store.csi.x-k8s.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>SecretProviderClass</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>azure-kvname</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>provider</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>azure</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>parameters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>usePodIdentity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;false&#34;</span><span style=color:#f8f8f8;text-decoration:underline>               </span><span style=color:#8f5902;font-style:italic># [OPTIONAL] if not provided, will default to &#34;false&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>useVMManagedIdentity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;false&#34;</span><span style=color:#f8f8f8;text-decoration:underline>         </span><span style=color:#8f5902;font-style:italic># [OPTIONAL available for version &gt; 0.0.4] if not provided, will default to &#34;false&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>userAssignedIdentityID</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;client_id&#34;</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#8f5902;font-style:italic># [OPTIONAL available for version &gt; 0.0.4] use the client id to specify which user assigned managed identity to use. If using a user assigned identity as the VM&#39;s managed identity, then specify the identity&#39;s client id. If empty, then defaults to use the system assigned identity on the VM</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>clientID</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;client_id&#34;</span><span style=color:#f8f8f8;text-decoration:underline>                 </span><span style=color:#8f5902;font-style:italic># [OPTIONAL available for version &gt; 1.1.0] client id of the Azure AD Application or managed identity to use for workload identity</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>keyvaultName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;kvname&#34;</span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#8f5902;font-style:italic># the name of the KeyVault</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>cloudName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>                         </span><span style=color:#8f5902;font-style:italic># [OPTIONAL available for version &gt; 0.0.4] if not provided, azure environment will default to AzurePublicCloud</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>cloudEnvFileName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#8f5902;font-style:italic># [OPTIONAL available for version &gt; 0.0.7] use to define path to file for populating azure environment</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>objects</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic>|
</span><span style=color:#8f5902;font-style:italic>      array:
</span><span style=color:#8f5902;font-style:italic>        - |
</span><span style=color:#8f5902;font-style:italic>          objectName: secret1
</span><span style=color:#8f5902;font-style:italic>          objectAlias: SECRET_1           # [OPTIONAL available for version &gt; 0.0.4] object alias
</span><span style=color:#8f5902;font-style:italic>          objectType: secret              # object types: secret, key or cert. For Key Vault certificates, refer to https://azure.github.io/secrets-store-csi-driver-provider-azure/configurations/getting-certs-and-keys/ for the object type to use
</span><span style=color:#8f5902;font-style:italic>          objectVersion: &#34;&#34;               # [OPTIONAL] object versions, default to latest if empty
</span><span style=color:#8f5902;font-style:italic>          objectVersionHistory: 5         # [OPTIONAL] if greater than 1, the number of versions to sync starting at the specified version.
</span><span style=color:#8f5902;font-style:italic>          filePermission: 0755                # [OPTIONAL] permission for secret file being mounted into the pod, default is 0644 if not specified.
</span><span style=color:#8f5902;font-style:italic>        - |
</span><span style=color:#8f5902;font-style:italic>          objectName: key1
</span><span style=color:#8f5902;font-style:italic>          objectAlias: &#34;&#34;                 # If provided then it has to be referenced in [secretObjects].[objectName] to sync with Kubernetes secrets 
</span><span style=color:#8f5902;font-style:italic>          objectType: key
</span><span style=color:#8f5902;font-style:italic>          objectVersion: &#34;&#34;
</span><span style=color:#8f5902;font-style:italic>    tenantID: &#34;tid&#34;                       # the tenant ID of the KeyVault
</span><span style=color:#8f5902;font-style:italic>
</span></code></pre></div><table><thead><tr><th>Name</th><th>Required</th><th>Description</th><th>Default Value</th></tr></thead><tbody><tr><td>provider</td><td>yes</td><td>specify name of the provider</td><td>""</td></tr><tr><td>usePodIdentity</td><td>no</td><td>set to true for using aad-pod-identity to access keyvault</td><td>&ldquo;false&rdquo;</td></tr><tr><td>useVMManagedIdentity</td><td>no</td><td>[<strong><em>available for version > 0.0.4</em></strong>] specify access mode to enable use of User-assigned managed identity</td><td>&ldquo;false&rdquo;</td></tr><tr><td>userAssignedIdentityID</td><td>no</td><td>[<strong><em>available for version > 0.0.4</em></strong>] the user assigned identity ID is required for User-assigned Managed Identity mode</td><td>""</td></tr><tr><td>clientID</td><td>no</td><td>[<strong><em>available for version > 1.1.0</em></strong>] client id of the Azure AD Application or managed identity to use for workload identity</td><td>""</td></tr><tr><td>keyvaultName</td><td>yes</td><td>name of a Key Vault instance</td><td>""</td></tr><tr><td>cloudName</td><td>no</td><td>[<strong><em>available for version > 0.0.4</em></strong>] name of the azure cloud based on azure go sdk (AzurePublicCloud, AzureUSGovernmentCloud, AzureChinaCloud, AzureGermanCloud, AzureStackCloud)</td><td>""</td></tr><tr><td>cloudEnvFileName</td><td>no</td><td>[<strong><em>available for version > 0.0.7</em></strong>] path to the file to be used while populating the Azure Environment (required if target cloud is AzureStackCloud). More details <a href=../../configurations/custom-environments>here</a>.</td><td>""</td></tr><tr><td>objects</td><td>yes</td><td>a string of arrays of strings</td><td>""</td></tr><tr><td>objectName</td><td>yes</td><td>name of a Key Vault object</td><td>""</td></tr><tr><td>objectAlias</td><td>no</td><td>[<strong><em>available for version > 0.0.4</em></strong>] specify the filename of the object when written to disk - defaults to objectName if not provided</td><td>""</td></tr><tr><td>objectType</td><td>yes</td><td>type of a Key Vault object: secret, key or cert.<br>For Key Vault certificates, refer to <a href=../../configurations/getting-certs-and-keys>doc</a> for the object type to use.</br></td><td>""</td></tr><tr><td>objectVersion</td><td>no</td><td>version of a Key Vault object, if not provided, will use latest</td><td>""</td></tr><tr><td>objectVersionHistory</td><td>no</td><td>[<strong><em>available for version > v1.3.0</em></strong>] number of previous versions to sync, if not provided, will only sync the specified versions</td><td>0</td></tr><tr><td>objectFormat</td><td>no</td><td>[<strong><em>available for version > 0.0.7</em></strong>] the format of the Azure Key Vault object, supported types are pem and pfx. <code>objectFormat: pfx</code> is only supported with <code>objectType: secret</code> and PKCS12 or ECC certificates</td><td>&ldquo;pem&rdquo;</td></tr><tr><td>objectEncoding</td><td>no</td><td>[<strong><em>available for version > 0.0.8</em></strong>] the encoding of the Azure Key Vault secret object, supported types are <code>utf-8</code>, <code>hex</code> and <code>base64</code>. This option is supported only with <code>objectType: secret</code></td><td>&ldquo;utf-8&rdquo;</td></tr><tr><td>filePermission</td><td>no</td><td>[<strong><em>available for version > v1.1.0</em></strong>] permission for secret file being mounted into the pod</td><td>&ldquo;0644&rdquo;</td></tr><tr><td>tenantID</td><td>yes</td><td>tenant ID containing the Key Vault instance. Should be set to <code>"adfs"</code> for <a href=../../configurations/custom-environments>Azure Stack Hub clouds</a> using the AD FS identity provider system</td><td>""</td></tr></tbody></table><h4 id=provide-identity-to-access-key-vault>Provide Identity to Access Key Vault</h4><p>The Azure Key Vault Provider offers five modes for accessing a Key Vault instance:</p><ol><li><a href=../../configurations/identity-access-modes/service-principal-mode>Service Principal</a> ** This is currently the only way to connect to Azure Key Vault from a non Azure environment.</li><li><a href=../../configurations/identity-access-modes/pod-identity-mode>Pod Identity</a></li><li><a href=../../configurations/identity-access-modes/user-assigned-msi-mode>User-assigned Managed Identity</a></li><li><a href=../../configurations/identity-access-modes/system-assigned-msi-mode>System-assigned Managed Identity</a></li><li><a href=../../configurations/identity-access-modes/workload-identity-mode>Workload Identity</a></li></ol><h4 id=update-your-deployment-yaml>Update your Deployment Yaml</h4><p>To ensure your application is using the Secrets Store CSI driver, update your deployment yaml to use the <code>secrets-store.csi.k8s.io</code> driver and reference the <code>SecretProviderClass</code> resource created in the previous step.</p><p>Update your <a href=https://raw.githubusercontent.com/Azure/secrets-store-csi-driver-provider-azure/master/examples/service-principal/pod-inline-volume-service-principal.yaml>deployment yaml</a> to use the Secrets Store CSI driver and reference the <code>SecretProviderClass</code> resource created in the previous step.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>volumes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>secrets-store-inline</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>csi</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>driver</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>secrets-store.csi.k8s.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>readOnly</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>volumeAttributes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>secretProviderClass</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;azure-kvname&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></code></pre></div><h4 id=deploy-your-kubernetes-resources>Deploy your Kubernetes Resources</h4><ol><li><p>Deploy the SecretProviderClass yaml created previously. For example:</p><p><code>kubectl apply -f https://raw.githubusercontent.com/Azure/secrets-store-csi-driver-provider-azure/master/examples/service-principal/v1alpha1_secretproviderclass_service_principal.yaml</code></p></li><li><p>Deploy the application yaml created previously. For example:</p><p><code>kubectl apply -f https://raw.githubusercontent.com/Azure/secrets-store-csi-driver-provider-azure/master/examples/service-principal/pod-inline-volume-service-principal.yaml</code></p></li></ol><h4 id=validate-the-secret>Validate the secret</h4><p>To validate, once the pod is started, you should see the new mounted content at the volume path specified in your deployment yaml.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#8f5902;font-style:italic>## show secrets held in secrets-store</span>
kubectl <span style=color:#204a87>exec</span> busybox-secrets-store-inline -- ls /mnt/secrets-store/

<span style=color:#8f5902;font-style:italic>## print a test secret held in secrets-store</span>
kubectl <span style=color:#204a87>exec</span> busybox-secrets-store-inline -- cat /mnt/secrets-store/secret1
</code></pre></div><h4 id=syncing-multiple-versions-of-a-secret>Syncing Multiple Versions of a Secret</h4><p>The Azure Key Vault Provider allows syncing previous versions of a secret via the <code>objectVersionHistory</code> property. If this property is specified, and the value is greater than 1, the provider will sync up to that many versions of the specified secret starting with the version specified. The file name for each version of the secret will be <code>{objectAlias}/{versionIndex}</code> where version index is the 0-based starting with the latest version.</p><p>If you want to sync one of these versions with a kubernetes secret, the only difference is that you have to specify which version you want (i.e., to use the latest version, you specify <code>{objectAlias}/0</code> in <code>[secretObjects].[objectName]</code>)</p><h5 id=permissions>Permissions</h5><p>If you use this functionality, the principal being used to access Key Vault will also need the list permission for secrets, keys, and certificates.</p><div class=section-index><hr class=panel-line></div><style>.feedback--answer{display:inline-block}.feedback--answer-no{margin-left:1em}.feedback--response{display:none;margin-top:1em}.feedback--response__visible{display:block}</style><div class=d-print-none><h2 class=feedback--title>Feedback</h2><p class=feedback--question>Was this page helpful?</p><button class="feedback--answer feedback--answer-yes">Yes</button>
<button class="feedback--answer feedback--answer-no">No</button><p class="feedback--response feedback--response-yes">Glad to hear it! Please <a href=https://github.com/Azure/secrets-store-csi-driver-provider-azure/issues/new>tell us how we can improve</a>.</p><p class="feedback--response feedback--response-no">Sorry to hear that. Please <a href=https://github.com/Azure/secrets-store-csi-driver-provider-azure/issues/new>tell us how we can improve</a>.</p></div><script>const yesButton=document.querySelector('.feedback--answer-yes');const noButton=document.querySelector('.feedback--answer-no');const yesResponse=document.querySelector('.feedback--response-yes');const noResponse=document.querySelector('.feedback--response-no');const disableButtons=()=>{yesButton.disabled=true;noButton.disabled=true;};const sendFeedback=(value)=>{if(typeof ga!=='function')return;const args={command:'send',hitType:'event',category:'Helpful',action:'click',label:window.location.pathname,value:value};ga(args.command,args.hitType,args.category,args.action,args.label,args.value);};yesButton.addEventListener('click',()=>{yesResponse.classList.add('feedback--response__visible');disableButtons();sendFeedback(1);});noButton.addEventListener('click',()=>{noResponse.classList.add('feedback--response__visible');disableButtons();sendFeedback(0);});</script><br><div class="text-muted mt-5 pt-3 border-top">Last modified January 20, 2023: <a href=https://github.com/Azure/secrets-store-csi-driver-provider-azure/commit/c88f03f1c0020eb3b0f9951f4454c822e7f4ce3b>docs: Update documentation to reflect change from 'tenantId' to 'tenantID' (#1057) (c88f03f)</a></div></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Slack aria-label=Slack><a class=text-white target=_blank rel="noopener noreferrer" href=https://kubernetes.slack.com/archives/C013PUP2WRK><i class="fab fa-slack"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel="noopener noreferrer" href=https://github.com/Azure/secrets-store-csi-driver-provider-azure><i class="fab fa-github"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2023 Azure Compute OSS Upstream Team All Rights Reserved</small></div></div></div></footer></div><script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script><script src=/secrets-store-csi-driver-provider-azure/docs/js/main.min.f820bfc507c3ebefe17f8881ec4ee10013f3b89ad9555a50acf9bb1771e6823f.js integrity="sha256-+CC/xQfD6+/hf4iB7E7hABPzuJrZVVpQrPm7F3Hmgj8=" crossorigin=anonymous></script></body></html>